<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.3.1">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Michael DeCrescenzo">

  
  
  
    
  
  <meta name="description" content="a.sourceLine { display: inline-block; line-height: 1.25; } a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; } a.sourceLine:empty { height: 1.2em; } .sourceCode { overflow: visible; } code.sourceCode { white-space: pre; position: relative; } div.sourceCode { margin: 1em 0; } pre.sourceCode { margin: 0; } @media screen { div.sourceCode { overflow: auto; } } @media print { code.sourceCode { white-space: pre-wrap; } a.sourceLine { text-indent: -1em; padding-left: 1em; } } pre.">

  
  <link rel="alternate" hreflang="en-us" href="/post/viz-partials/">

  


  

  
  
  
  <meta name="theme-color" content="#268bd2">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/solarized-dark.min.css" crossorigin="anonymous" title="hl-light">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/solarized-dark.min.css" crossorigin="anonymous" title="hl-dark" disabled>
      
    

    

    

  

  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Serif+Pro:400,700|Fira+Sans:500|Roboto+Mono&display=swap">
  

  
  
  
  <link rel="stylesheet" href="/css/academic.min.710387c227532828b07a58243cbd13c3.css">

  

  
  
  

  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/post/viz-partials/">

  
  
  
  
    
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@mikedecr">
  <meta property="twitter:creator" content="@mikedecr">
  
  <meta property="og:site_name" content="Michael DeCrescenzo">
  <meta property="og:url" content="/post/viz-partials/">
  <meta property="og:title" content="A Visualization of Partial Effects in Multiple Regression | Michael DeCrescenzo">
  <meta property="og:description" content="a.sourceLine { display: inline-block; line-height: 1.25; } a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; } a.sourceLine:empty { height: 1.2em; } .sourceCode { overflow: visible; } code.sourceCode { white-space: pre; position: relative; } div.sourceCode { margin: 1em 0; } pre.sourceCode { margin: 0; } @media screen { div.sourceCode { overflow: auto; } } @media print { code.sourceCode { white-space: pre-wrap; } a.sourceLine { text-indent: -1em; padding-left: 1em; } } pre."><meta property="og:image" content="/img/circular-telles.png">
  <meta property="twitter:image" content="/img/circular-telles.png"><meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2018-10-19T00:00:00&#43;00:00">
  
  <meta property="article:modified_time" content="2018-10-19T00:00:00&#43;00:00">
  

  


  





  <title>A Visualization of Partial Effects in Multiple Regression | Michael DeCrescenzo</title>

</head>


<body id="top" data-spy="scroll" data-target="#TableOfContents" data-offset="71" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" role="textbox" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/"><img src="/img/circular-telles.png" alt="Michael DeCrescenzo"></a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav ml-auto">
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/about"><span>About</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/research"><span>Research</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/teaching"><span>Teaching</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/code"><span>Code</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/post"><span>Blog</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        

        
        <li class="nav-item">
          <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
        </li>
        

      </ul>

    </div>
  </div>
</nav>


  <article class="article" itemscope itemtype="http://schema.org/Article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1 itemprop="name">A Visualization of Partial Effects in Multiple Regression</h1>

  

  
    



<meta content="2018-10-19 00:00:00 &#43;0000 UTC" itemprop="datePublished">
<meta content="2018-10-19 00:00:00 &#43;0000 UTC" itemprop="dateModified">

<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    <time>Oct 19, 2018</time>
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    9 min read
  </span>
  

  
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder"></i>
    <a href="/categories/methods/">Methods</a></span>
  

  
    
<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=/post/viz-partials/&amp;text=A%20Visualization%20of%20Partial%20Effects%20in%20Multiple%20Regression" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=/post/viz-partials/&amp;t=A%20Visualization%20of%20Partial%20Effects%20in%20Multiple%20Regression" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook-f"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=A%20Visualization%20of%20Partial%20Effects%20in%20Multiple%20Regression&amp;body=/post/viz-partials/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=/post/viz-partials/&amp;title=A%20Visualization%20of%20Partial%20Effects%20in%20Multiple%20Regression" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=A%20Visualization%20of%20Partial%20Effects%20in%20Multiple%20Regression%20/post/viz-partials/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=/post/viz-partials/&amp;title=A%20Visualization%20of%20Partial%20Effects%20in%20Multiple%20Regression" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>


  

</div>

    














  
</div>



  <div class="article-container">

    <div class="article-style" itemprop="articleBody">
      
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #ffffff;
    color: #a0a0a0;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
div.sourceCode
  { color: #1f1c1b; background-color: #ffffff; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span. { color: #1f1c1b; } /* Normal */
code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
code span.an { color: #ca60ca; } /* Annotation */
code span.at { color: #0057ae; } /* Attribute */
code span.bn { color: #b08000; } /* BaseN */
code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
code span.ch { color: #924c9d; } /* Char */
code span.cn { color: #aa5500; } /* Constant */
code span.co { color: #898887; } /* Comment */
code span.cv { color: #0095ff; } /* CommentVar */
code span.do { color: #607880; } /* Documentation */
code span.dt { color: #0057ae; } /* DataType */
code span.dv { color: #b08000; } /* DecVal */
code span.er { color: #bf0303; text-decoration: underline; } /* Error */
code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
code span.fl { color: #b08000; } /* Float */
code span.fu { color: #644a9b; } /* Function */
code span.im { color: #ff5500; } /* Import */
code span.in { color: #b08000; } /* Information */
code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
code span.op { color: #1f1c1b; } /* Operator */
code span.ot { color: #006e28; } /* Other */
code span.pp { color: #006e28; } /* Preprocessor */
code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
code span.sc { color: #3daee9; } /* SpecialChar */
code span.ss { color: #ff5500; } /* SpecialString */
code span.st { color: #bf0303; } /* String */
code span.va { color: #0057ae; } /* Variable */
code span.vs { color: #bf0303; } /* VerbatimString */
code span.wa { color: #bf0303; } /* Warning */
</style>


<div id="background" class="section level1">
<h1>Background</h1>
<p>A few days ago, <a href="https://www.andrewheiss.com/">Andrew Heiss</a> was <a href="https://twitter.com/andrewheiss/status/1052232993723494400?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1052232993723494400&amp;ref_url=http%3A%2F%2F127.0.0.1%3A4321%2F2018%2F2018-10-19-partialling-out%2F">looking</a> for a way to visualize multiple regression with an emphasis on one predictor, without 3(+)-dimensional plots. He works through a method and posts this cool animation, which shows the changing relationship between <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> when adding controls, superimposed over the scatterplot of the raw data. (He credits <a href="https://twitter.com/petemohanty">Pete Mohanty</a> with the shifting abline idea.)</p>
<center>
<blockquote class="twitter-tweet" data-lang="en">
<p lang="en" dir="ltr">
Helpful animated <a href="https://twitter.com/hashtag/dataviz?src=hash&amp;ref_src=twsrc%5Etfw">#dataviz</a> showing what happens to the slope of one coefficient in a model when controlling for other variables in multiple regression<br><br>(<a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a> code: <a href="https://t.co/yhVLj325Oh">https://t.co/yhVLj325Oh</a>) <a href="https://t.co/2foYfXDo28">pic.twitter.com/2foYfXDo28</a>
</p>
— 🎃 Andrew Heiss, scary PhD 🦇 (<span class="citation">@andrewheiss</span>) <a href="https://twitter.com/andrewheiss/status/1052978108255498240?ref_src=twsrc%5Etfw">October 18, 2018</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</center>
<p>This is cool, but based on Andrew’s initial question, I had something a little different come to mind. I thought we’d be seeing the impact of the regression in both the regression line <em>and</em> in the data. So I tried to make that (starting with <a href="https://t.co/yhVLj325Oh">his code</a>)…</p>
<center>
<blockquote class="twitter-tweet" data-conversation="none" data-lang="en">
<p lang="en" dir="ltr">
Ok fixed. <br><br>In this fig, y is (beta * humidity), plus the regression residual. This is equivalent to starting with the fully estimated regression and subtracting out terms for every other covariate <a href="https://t.co/fLs4WxHTaK">pic.twitter.com/fLs4WxHTaK</a>
</p>
— Michael DeCrescenzo (<span class="citation">@mikedecr</span>) <a href="https://twitter.com/mikedecr/status/1053028075170975744?ref_src=twsrc%5Etfw">October 18, 2018</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</center>
<p>which he <a href="https://twitter.com/andrewheiss/status/1053031575770718208">liked</a> and asked to see the code for.</p>
<p>So I will deliver. <a href="https://gist.github.com/mikedecr/f6ffdb716d62af32e701f95231f00bee">Here</a> is a gist containing an example, and below is some explanation.</p>
</div>
<div id="intuition" class="section level1">
<h1>Intuition</h1>
<p>Some math will help. Let’s start by writing the regression equation to suit the task at hand: although we include multiple predictors, we only want to highlight one of them, putting the other predictors into a black box “vector of controls.” Andrew’s example uses Dark Sky data on weather in Provo, UT, highlighting the relationship between humidity and a daily temperature high for each day <span class="math inline">\(i\)</span>…
<span class="math display">\[\begin{align}
  \mathit{HighTemp}_{i} &amp;= \alpha + \beta\left(\mathit{Humidity}_{i}\right) + \mathbf{x}_{i}^{T}\gamma + \varepsilon_{i}
\end{align}\]</span>
where <span class="math inline">\(\alpha\)</span> is the constant, <span class="math inline">\(\mathbf{x}_{i}\)</span> is a column-vector of covariate observations for unit <span class="math inline">\(i\)</span> (everything but humidity), and <span class="math inline">\(\gamma\)</span> is a vector of coefficients for all non-humidity predictors.</p>
<p>Operationally, what we want to do is show how <span class="math inline">\(\beta\)</span> changes with the inclusion of additional controls. Andrew’s example shows this by plotting different regressions overtop the raw data. If we run the code<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> from his <a href="https://gist.github.com/andrewheiss/5e162c836575721d1dd53ec2af38753c">Gist</a>:</p>
<p><img src="/post/2018-10-19-partialling-out_files/figure-html/andrew-animate-1.gif" /><!-- --></p>
<p>The line being plotted starts with <span class="math inline">\(\hat{\mathit{High}}_{i} = {\alpha} + {\beta}(\mathit{Humidity}_{i})\)</span> and adds additional covariates one at a time. The data remain intact.</p>
</div>
<div id="variation" class="section level1">
<h1>Variation</h1>
<p>But let’s say that we wanted to see the effect of controls in the data as well. This is, I think, where the real umph from this kind of visualization would be; after all, we have already told students that including other predictors will affect the line.</p>
<p>Thinking about the math, this is as easy as doing to the raw data what we’ve already done to the regression line: subtract out the effect of the covariates. That is, purge the effect of other variables from the raw data. Start with the fully specified regression model…
<span class="math display">\[\begin{align}
  \mathit{High}_{i} &amp;= \alpha + \beta\left(\mathit{Humidity}_{i}\right) + \mathbf{x}_{i}^{T}\gamma + \varepsilon_{i}
\end{align}\]</span>
…and then subtract out the influence of variables in <span class="math inline">\(\mathbf{x}_{i}\)</span>.
<span class="math display">\[\begin{align}
  \label{eq:sub} \mathit{High}_{i} - \mathbf{x}^{T}\gamma &amp;= \alpha + \beta\left(\mathit{Humidity}_{i}\right) + \varepsilon_{i}
\end{align}\]</span></p>
<p>We still have to decide what to do with the constant. We could…</p>
<ul>
<li>Leave the constant there, which is probably undesirable because the value of the constant reflects the scaling of other covariates.</li>
<li>Start by setting all covariates equal to their means. This would give us a prediction that is no longer subject to the <em>scaling</em> of the covariates but the covariates still affect the mean of <span class="math inline">\(y\)</span> overall. This works but I think we can make it simpler.</li>
<li>Subtract the constant along with the covariates. This leaves us with only the predicted partial effect of humidity (plus error). This is what we’ll do, because it zooms in only on the predictor that we care about.</li>
</ul>
</div>
<div id="implementation" class="section level1">
<h1>Implementation</h1>
<p>Now we will create the revised gif.</p>
<p>First we start with the original Heiss data and code.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># ---- Heiss code -----------------------</span>

<span class="kw">library</span>(<span class="st">&quot;magrittr&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;lubridate&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;broom&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;scales&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;gganimate&quot;</span>)

<span class="co"># Load and clean data</span>
<span class="co"># This data comes from Dark Sky&#39;s API</span>
weather_provo_raw &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;https://andhs.co/provoweather&quot;</span>)

<span class="co"># clean dates and precip</span>
weather_provo_<span class="dv">2017</span> &lt;-<span class="st"> </span>weather_provo_raw <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">month =</span> <span class="kw">month</span>(date, <span class="dt">label =</span> <span class="ot">TRUE</span>, <span class="dt">abbr =</span> <span class="ot">FALSE</span>),
    <span class="dt">month_number =</span> <span class="kw">month</span>(date, <span class="dt">label =</span> <span class="ot">FALSE</span>),
    <span class="dt">weekday =</span> <span class="kw">wday</span>(date, <span class="dt">label =</span> <span class="ot">TRUE</span>, <span class="dt">abbr =</span> <span class="ot">FALSE</span>),
    <span class="dt">weekday_number =</span> <span class="kw">wday</span>(date, <span class="dt">label =</span> <span class="ot">FALSE</span>),
    <span class="dt">precipType =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(precipType), <span class="st">&quot;none&quot;</span>, precipType)
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(
    date, month, month_number, weekday, weekday_number,
    sunriseTime, sunsetTime, moonPhase, 
    precipProbability, precipType, temperatureHigh, temperatureLow, dewPoint, 
    humidity, pressure, windSpeed, cloudCover, visibility, uvIndex
  )

<span class="co"># keep winter and spring, scale vars</span>
winter_spring &lt;-<span class="st"> </span>weather_provo_<span class="dv">2017</span> <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(month_number <span class="op">&lt;=</span><span class="st"> </span><span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">month =</span> <span class="kw">factor</span>(month, <span class="dt">ordered =</span> <span class="ot">FALSE</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">humidity =</span> humidity <span class="op">*</span><span class="st"> </span><span class="dv">100</span>, 
    <span class="dt">cloudCover =</span> cloudCover <span class="op">*</span><span class="st"> </span><span class="dv">100</span>, 
    <span class="dt">precipProbability =</span> precipProbability <span class="op">*</span><span class="st"> </span><span class="dv">100</span>
  )</code></pre>
<p>We combine several model formulas into a data frame and estimate each regression using <code>purrr::map()</code>. We’ve added the results from <code>broom::augment()</code> because we want the residuals from each model to create the “noise” in the data for the graphic.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># ---- mike decrescenzo modifications begin -----------------------</span>

<span class="co"># Run all these models in one data frame (purrr::map)</span>
<span class="co"># add the data as a list column because we&#39;ll want it later</span>
models &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">tribble</span>(
    <span class="op">~</span>formula,
    <span class="st">&quot;temperatureHigh ~ humidity&quot;</span>,
    <span class="st">&quot;temperatureHigh ~ humidity + windSpeed&quot;</span>,
    <span class="st">&quot;temperatureHigh ~ humidity + windSpeed + cloudCover&quot;</span>,
    <span class="st">&quot;temperatureHigh ~ humidity + windSpeed + cloudCover + precipProbability&quot;</span>,
    <span class="st">&quot;temperatureHigh ~ humidity + windSpeed + cloudCover + precipProbability + visibility&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># data in a list column</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">spring_data =</span> <span class="kw">list</span>(winter_spring)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># Run a model in each row</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="kw">map2</span>(formula, spring_data, <span class="op">~</span><span class="st"> </span><span class="kw">lm</span>(.x, <span class="dt">data =</span> .y))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># Extract model elements</span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">model_tidy =</span> <span class="kw">map</span>(model, tidy, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>), 
    <span class="dt">model_glance =</span> <span class="kw">map</span>(model, glance), 
    <span class="dt">model_fits =</span> <span class="kw">map</span>(model, augment)
  )</code></pre>
<p>We calculate the impact of humidity on the high temperature by extracting the humidity coefficient from each model and multiplying it by the raw humidity data (which comes in the <code>augment</code> results). We will lazily refer to this as the humidity’s “partial prediction” of temperature (thanks to <a href="https://twitter.com/EvaMaeRey">Gina Reynolds</a> for feedback on what this should be called). As a bonus, we will also save the upper and lower bounds of the humidity beta confidence interval.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># compute the partial effect of humidity: beta * humidity</span>
model_partials &lt;-<span class="st"> </span>models <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># get the humidity beta and bounds</span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">humidity_beta =</span> 
      <span class="kw">map</span>(model_tidy, <span class="op">~</span><span class="st"> </span><span class="kw">filter</span>(.x, term <span class="op">==</span><span class="st"> &quot;humidity&quot;</span>)<span class="op">$</span>estimate) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                        </span><span class="kw">as.numeric</span>(),
    <span class="dt">beta_low =</span> 
      <span class="kw">map</span>(model_tidy, <span class="op">~</span><span class="st"> </span><span class="kw">filter</span>(.x, term <span class="op">==</span><span class="st"> &quot;humidity&quot;</span>)<span class="op">$</span>conf.low) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                        </span><span class="kw">as.numeric</span>(),
    <span class="dt">beta_high =</span> 
      <span class="kw">map</span>(model_tidy, <span class="op">~</span><span class="st"> </span><span class="kw">filter</span>(.x, term <span class="op">==</span><span class="st"> &quot;humidity&quot;</span>)<span class="op">$</span>conf.high) <span class="op">%&gt;%</span>
<span class="st">                        </span><span class="kw">as.numeric</span>()
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># calculate partial effect of humidity and keep the residual</span>
<span class="st">  </span><span class="kw">unnest</span>(model_fits) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">partial =</span> humidity <span class="op">*</span><span class="st"> </span>humidity_beta) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(formula, humidity, <span class="kw">contains</span>(<span class="st">&quot;beta&quot;</span>), partial, .resid) 

<span class="co"># get the beta for label plotting</span>
model_beta &lt;-<span class="st"> </span>model_partials <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(formula, <span class="kw">contains</span>(<span class="st">&quot;beta&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">distinct</span>() </code></pre>
<p>Now we create the figure. The horizontal axis is the raw humidity data. The vertical axis is the humidity effect (<span class="math inline">\(\beta \times \mathit{Humidity}_{i}\)</span>) plus the regression residual <span class="math inline">\(\varepsilon_{i}\)</span>. The regression line is simply <span class="math inline">\(\hat{\mathit{High}}_{i} = \hat{\beta}\mathit{Humidity}_{i}\)</span> with a constant of zero. That is, on a given day, a humidity level of <span class="math inline">\(z\)</span> exerts a negative impact on temperature amounting to <span class="math inline">\(\beta z\)</span>, setting other factors aside. Conveniently, we don’t have to manually subtract the other covariates because we already know how to calculate the vertical axis using the partial effect and the residual (thanks to the math above).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># animate </span>
<span class="kw">ggplot</span>(<span class="dt">data =</span> model_partials, <span class="kw">aes</span>(<span class="dt">x =</span> humidity, <span class="dt">y =</span> partial <span class="op">+</span><span class="st"> </span>.resid)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;gray&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_abline</span>(
    <span class="dt">data =</span> model_beta, 
    <span class="kw">aes</span>(<span class="dt">intercept =</span> <span class="dv">0</span>, <span class="dt">slope =</span> humidity_beta, <span class="dt">group =</span> formula)
  ) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_abline</span>(
    <span class="dt">data =</span> model_beta, 
    <span class="kw">aes</span>(<span class="dt">intercept =</span> <span class="dv">0</span>, <span class="dt">slope =</span> beta_low, <span class="dt">group =</span> formula), 
    <span class="dt">linetype =</span> <span class="dv">3</span>
  ) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_abline</span>(
    <span class="dt">data =</span> model_beta, 
    <span class="kw">aes</span>(<span class="dt">intercept =</span> <span class="dv">0</span>, <span class="dt">slope =</span> beta_high, <span class="dt">group =</span> formula), 
    <span class="dt">linetype =</span> <span class="dv">3</span>
    ) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>(<span class="dt">base_family =</span> <span class="st">&quot;Fira Sans&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_label</span>(
    <span class="dt">data =</span> model_beta, 
    <span class="kw">aes</span>(<span class="dt">x =</span> <span class="dv">35</span>, <span class="dt">y =</span> <span class="dv">-70</span>, 
        <span class="dt">label =</span> <span class="kw">paste0</span>(<span class="st">&quot;beta: &quot;</span>, <span class="kw">round</span>(humidity_beta, <span class="dv">3</span>)), 
        <span class="dt">group =</span> formula), 
    <span class="dt">parse =</span> <span class="ot">TRUE</span>, 
    <span class="dt">family =</span> <span class="st">&quot;Fira Sans&quot;</span>, 
    <span class="dt">size =</span> <span class="dv">4</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">x =</span> <span class="st">&quot;Humidity&quot;</span>, 
    <span class="dt">y =</span> <span class="st">&quot;Partial Predicted High Temperature (plus residual, °F)&quot;</span>, 
    <span class="dt">subtitle =</span> <span class="st">&quot;{closest_state}&quot;</span>
  ) <span class="op">+</span>
<span class="st">  </span><span class="kw">transition_states</span>(formula, <span class="dt">transition_length =</span> <span class="fl">0.25</span>, <span class="dt">state_length =</span> <span class="fl">0.5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">enter_fade</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">ease_aes</span>(<span class="st">&#39;sine-in-out&#39;</span>)</code></pre>
<p><img src="/post/2018-10-19-partialling-out_files/figure-html/animated-1.gif" /><!-- --></p>
<p>Two notes about the confidence interval</p>
<ol style="list-style-type: decimal">
<li>The confidence intervals here don’t look like the ordinary hourglass-shaped intervals in linear regression. This is because the hourglass shape comes from uncertainty in both the constant and coefficients. However, the constant has been subtracted out of these predictions, so uncertainty in this visualization only reflects uncertainty in the humidity effect.</li>
<li>I would show confidence intervals with <code>geom_ribbon()</code>, except I can’t get ribbons to animate because of some weird stuff that’s interfering with <a href="https://github.com/thomasp85/transformr">transformr</a> during animation.</li>
</ol>
</div>
<div id="thats-it" class="section level1">
<h1>That’s it</h1>
<p>I don’t have comments enabled on the website but get at me on <a href="https://twitter.com/mikedecr">Twitter</a>.</p>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Maybe it’s a dev version thing, but <code>scales::degree_format()</code> doesn’t work for me, so I removed it.<a href="#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</div>

    </div>

    

<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/visualization/">Visualization</a>
  
  <a class="badge badge-light" href="/tags/r/">R</a>
  
</div>



    
      








  





  
  
  
    
  
  
  <div class="media author-card" itemscope itemtype="http://schema.org/Person">
    
      
      <img class="portrait mr-3" src="/authors/admin/avatar-nelson_hue1097363fe96fa554517b0e16128d3a0_5324589_250x250_fill_lanczos_center_2.png" itemprop="image" alt="Avatar">
    

    <div class="media-body">
      <h5 class="card-title" itemprop="name"><a href="/">Michael DeCrescenzo</a></h5>
      <h6 class="card-subtitle">Ph.D. Candidate, Political Science</h6>
      <p class="card-text" itemprop="description">U.S. Electoral Politics, Bayesian Analysis, Meta-Research</p>
      <ul class="network-icon" aria-hidden="true">
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="/#contact" >
              <i class="fas fa-paper-plane"></i>
            </a>
          </li>
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://github.com/mikedecr" target="_blank" rel="noopener">
              <i class="fas fa-code-branch"></i>
            </a>
          </li>
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://twitter.com/mikedecr" target="_blank" rel="noopener">
              <i class="fab fa-twitter"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>



      
      
    

    

    


  </div>
</article>

      

    
    
    
    <script src="/js/mathjax-config.js"></script>
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js" integrity="sha256-aYTdUrn6Ow1DDgh5JTc3aDGnnju48y/1c8s1dgkYPQ8=" crossorigin="anonymous"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/r.min.js"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/tex.min.js"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/bib.min.js"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/txt.min.js"></script>
        
      

      
      
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_CHTML-full" integrity="sha256-GhM+5JHb6QUzOQPXSJLEWP7R73CbkisjzK5Eyij4U9w=" crossorigin="anonymous" async></script>
      
    

    
    

    
    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.f1a21f988a77cdbdeeb2f60c710009d1.js"></script>

    






  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    &copy; Michael DeCrescenzo 2019 &middot; 

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>
  
  
<script type="text/javascript">
var sc_project=11382424; 
var sc_invisible=1; 
var sc_security="647b3843"; 
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js"
async></script>
<noscript><div class="statcounter"><a title="free hit
counter" href="https://statcounter.com/"
target="_blank"><img class="statcounter"
src="https://c.statcounter.com/11382424/0/647b3843/1/"
alt="free hit counter"></a></div></noscript>


</body>
</html>
