<!DOCTYPE html>
<html lang="en-us">
<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<meta name="description" content="PhD Candidate, Political Science, University of Wisconsin–Madison">
<meta name="keywords" content="[political science wisconsin]">

<base href="/">

<title>Michael DeCrescenzo</title>

<meta name="generator" content="Hugo 0.31.1" />




<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/rainbow.min.css">



<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,400|Roboto+Slab:400,700|Roboto:300,300i,400,400i,500,500i,700,700i">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/main.css">




<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/ico" href="/favicon-32x32.ico" sizes="32x32">
<link rel="icon" type="image/ico" href="/favicon-16x16.ico" sizes="16x16">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="theme-color" content="#ffffff">

</head>
<body lang="en-us">
<div class="container">


<header class="row text-left title">
  <h1 class="title">Lecture 3: Analysis</h1>
</header>
<section id="category-pane" class="row meta">
  
  <div class="col-md-12">
    <h6 class="text-left meta">
        UPDATED MAR 1, 2018 
      
      
      
      —
      
      
      <a class="meta" href="/categories/r">R</a>, 
      
      <a class="meta" href="/categories/teaching">TEACHING</a>, 
      
      <a class="meta" href="/categories/ps811">PS811</a>
      
      
      
    </h6>
  </div>
  
</section>
<section id="content-pane" class="row">
  <div class="col-md-12 text-justify content">
    <hr />
<div id="sarah" class="section level1">
<h1>Sarah</h1>
<ul>
<li>why</li>
<li>helpful to see what the data look like</li>
<li>tell persuasive stories</li>
<li>important that you know relevant features of the data</li>
<li>shape of the data indicate appropriate modeling
<ul>
<li><em>long right tails, logging</em></li>
</ul></li>
<li>Understanding data</li>
<li><em>know thy data</em></li>
<li>unit of analysis</li>
<li>number of observations</li>
<li>where is there variation</li>
<li>units of measurement</li>
<li>values within variable</li>
<li>missing data</li>
<li>relationships among variables</li>
<li>summary statistics</li>
<li><code>summary, cor, quantile</code></li>
<li><code>table()</code></li>
<li><code>group_by() %&gt;% summarize()</code></li>
<li><code>group.CI()</code> or whatever it’s called</li>
<li>simple base plots</li>
<li>scatterplots</li>
<li>histograms</li>
<li>kernel density estimation</li>
<li><em>transition to ggplot</em></li>
<li><em>data, axis aesthetics, geoms, scales, theme options</em></li>
<li><em>ggplot() and qplot() functions. qplot() is just confusing IMO</em></li>
<li><em>justify gglot</em>
<ul>
<li><em>more with less code</em></li>
<li><em>grouping</em></li>
<li><em>faceting</em></li>
<li><em>legends</em></li>
<li><em>prevents you from doing stupid shit</em></li>
<li>multiple y axes</li>
<li>bad aesthetic choices (multiple DVs at once)</li>
<li><em>saving is easier</em></li>
<li><em>they look better</em></li>
<li><em>easy to customize your own cute theme (help guides online but don’t include a link [don’t want them to get sidetracked] but don’t overdo it)</em></li>
</ul></li>
<li><em>once in GGplot</em></li>
<li>scatterplots (two continuous)</li>
<li>dot plots (factor x continuous) <em>replace bar plots</em></li>
<li>line graphs (two continuous where order matters, need to be sorted)</li>
<li>don’t use pie charts
<ul>
<li><em>anything in a pie chart should be a bar graph</em></li>
</ul></li>
<li>bar graphs
<ul>
<li><em>only things in a bar graphs should be counts and proportions, IMO</em></li>
<li><em>stacks of things that have a zero lower bound</em></li>
<li><em>don’t use them for 1-5 scales</em></li>
<li><em>IMO don’t use them for treatment effects. This makes no sense</em></li>
<li><em>they also make you use error bars on top of columns for CIs, which looks fugly IMO</em></li>
</ul></li>
<li><em>coefficient plots (wait on this?)</em></li>
<li><em>acf pacf</em> with some package</li>
<li>aesthetic choices</li>
<li>contrasting colors may be bad for colorblindness</li>
<li>gradients of the same color may be good for computer screens, but maybe not for print or shitty projectors</li>
<li>does the journal accept color? might want to think about ways around color</li>
<li>resources
<ul>
<li><a href="http://mkweb.bcgsc.ca/colorblind/" class="uri">http://mkweb.bcgsc.ca/colorblind/</a></li>
<li><a href="http://www.somersault1824.com/tips-for-designing-scientific-figures-for-color-blind-readers/" class="uri">http://www.somersault1824.com/tips-for-designing-scientific-figures-for-color-blind-readers/</a></li>
<li><a href="http://colorbrewer2.org/#type=sequential&amp;scheme=BuGn&amp;n=3" class="uri">http://colorbrewer2.org/#type=sequential&amp;scheme=BuGn&amp;n=3</a></li>
<li><a href="http://ggplot2.tidyverse.org/reference/scale_brewer.html" class="uri">http://ggplot2.tidyverse.org/reference/scale_brewer.html</a></li>
<li><code>viridis</code>! <em>but don’t overdo it</em></li>
</ul></li>
<li>saving</li>
<li>base
<ul>
<li><code>pdf(&quot;file.pdf&quot;, width =, height =); par(whatever); plot(whatever); dev.off()</code></li>
</ul></li>
<li>ggplot
<ul>
<li><code>ggplot(whatever); ggsave(whatever, width =, height =)</code></li>
</ul></li>
<li>Complex data analysis</li>
<li><em>note to self: learn about arm, rms</em>
<ul>
<li><em>if you don’t get to this, just say that you don’t do regressions that much, and you don’t do frequentist regression when you do, LOL</em></li>
</ul></li>
<li>regression functions
<ul>
<li>transform within function call (logs, interaction, factor dummies)</li>
</ul></li>
<li>glms
<ul>
<li>ols: y = (XB)</li>
<li>glm: link(y) = XB; y = inv_link(XB)</li>
<li>logit(p(y)) = XB. invlogit(XB) = p(y)</li>
</ul></li>
<li>interpreting model output</li>
<li>generating model output
<ul>
<li>table packages</li>
<li>list: <a href="https://stackoverflow.com/questions/5465314/tools-for-making-latex-tables-in-r" class="uri">https://stackoverflow.com/questions/5465314/tools-for-making-latex-tables-in-r</a></li>
<li>stargazer: <a href="https://cran.r-project.org/web/packages/stargazer/vignettes/stargazer.pdf" class="uri">https://cran.r-project.org/web/packages/stargazer/vignettes/stargazer.pdf</a></li>
<li>apsrtable: <a href="https://cran.r-project.org/web/packages/apsrtable/apsrtable.pdf" class="uri">https://cran.r-project.org/web/packages/apsrtable/apsrtable.pdf</a></li>
<li><em>I like xtable and texreg</em></li>
<li>there are pros and cons. Some are better for regression, summary statistics, just other tables you might make (xtable)</li>
<li><code>arm::coefplot</code></li>
<li><code>coefplot</code> package</li>
<li><code>coefplot2</code></li>
<li>I’d say: coefplots by hand using <code>broom</code> and <code>ggplot2</code>. Easy for jamming multiple models together</li>
<li><a href="http://varianceexplained.org/r/broom-intro/" class="uri">http://varianceexplained.org/r/broom-intro/</a></li>
<li><a href="https://arxiv.org/pdf/1412.3565.pdf" class="uri">https://arxiv.org/pdf/1412.3565.pdf</a></li>
<li><em>I’ve seen people do coefplots using base graphics and it’s like half the entire file. It’s fugly</em></li>
</ul></li>
<li>marginal effects
<ul>
<li>effects</li>
<li>zelig</li>
<li><em>sjplot</em></li>
</ul></li>
<li>post-estimation
<ul>
<li>residuals</li>
<li>(most models: normal on the index. OLS index = link)</li>
<li><em>Log Likelihood</em> (coef.test? where are there model things for GLMs?)</li>
<li><em>information criteria: AIC, WAIC</em></li>
<li>meant to estimate out-of-sample performance</li>
<li>see McElreath videos</li>
<li>since every fit is a combination of true + noise (even assuming perfect model)</li>
<li>don’t BIC</li>
<li>neither Bayesian nor IC</li>
</ul></li>
</ul>
<p>Improving on Sarah</p>
<ul>
<li>how tidy data becomes good for ggplot</li>
<li>stacking factors for grouping aesthetics</li>
<li>nail grouping as a benefit</li>
<li>if you have multiple countries, multiple states, multiple datasets</li>
<li>you <em>can</em> gather multiple DVs, but then you can’t get different axis labels, so do this only for private use OR with conceptually related variables for public use
<ul>
<li><em>use var-ecm graphic as a bad example</em></li>
</ul></li>
<li>What to do about model graphics</li>
<li>a simple regression example</li>
<li>use broom for coefficient plot</li>
<li>sjplot for a simple marginal effects?</li>
<li>broom: learn how <code>glance</code> works</li>
<li><code>predict(new.data)</code></li>
<li>effects?</li>
<li>margins?</li>
<li>arm?</li>
<li>rms?</li>
<li><em>and then save complex predictions for modeling day?</em></li>
<li>Other graphics tips</li>
<li>confidence interval things:
<ul>
<li>steep change look like narrow confidence intervals</li>
<li>confidence intervals are <em>vertical</em> for a given x value (find tumblr example)</li>
</ul></li>
<li>log(0)
<ul>
<li>are they counts? use a count model instead of a log</li>
<li>are they unequal probability? use an ordinal model</li>
</ul></li>
<li>stata vs R</li>
<li>if you have a simple OLS or GLM and want to do a simple prediction or simple MFX, Stata does this pretty well</li>
<li>R is way better for visualizing multiple models together (tidy data, broom, ggplot)</li>
</ul>
</div>
<div id="more-sarah" class="section level1">
<h1>more Sarah</h1>
<ul>
<li>“advanced topics”</li>
<li>looping</li>
<li>apply</li>
<li>nesting and mapping</li>
<li>lists</li>
<li>type coercion</li>
<li>things I plan to do already</li>
<li>pipes</li>
<li>dplyr</li>
<li>tidyverse</li>
<li>forcats</li>
<li>haven</li>
<li>readr</li>
<li>tidyr</li>
<li>stringr</li>
<li>what is the tidy time series thing? hms?</li>
<li>regex</li>
<li>just explain what it is. Not worth learning and not worth teaching right now</li>
<li>text analysis:</li>
<li>tm</li>
<li>tidytext</li>
<li>time series stuff</li>
<li>lubridate</li>
<li>what other time series packages are out there</li>
<li>Stata is maybe better?</li>
<li>R as front end</li>
<li>rcpp, sql, rpython (rselenium)</li>
<li>learning new packages</li>
<li>survey analysis</li>
<li>Sarah has a good story example!</li>
<li>Stata might be better</li>
<li>Bayesian analysis:</li>
<li>bugs, jags, stan
<ul>
<li>Jags probably easiest for custom models</li>
<li>learn JAGS from Gelman and Hill (who use BUGS but it’s very similar)</li>
<li>Jackman Bayes textbook</li>
<li>Stan definitely the fastest but learn r-like (requires a C++ like file)</li>
<li>Gelman et al BDA</li>
</ul></li>
<li>other packages for quick and dirty Bayes things
<ul>
<li><code>brms</code></li>
<li><code>rethinking</code></li>
</ul></li>
<li><em>decide how much you want to preach</em></li>
</ul>
<p>My advanced things:</p>
<ul>
<li>hierarchical models</li>
<li>figure out how badly you want this…</li>
<li>you like these but don’t actually do them all that much</li>
<li>function writing</li>
<li>bayesian example</li>
<li>apply and lapply</li>
<li>nest and map</li>
<li>hierarchical: mrp?</li>
</ul>
</div>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<ul>
<li>gelman quote about dumbest possible thing</li>
</ul>
</div>
<div id="nonstatistical-approaches" class="section level1">
<h1>Nonstatistical approaches</h1>
<div id="tabulating" class="section level2">
<h2>tabulating</h2>
</div>
<div id="aggregating" class="section level2">
<h2>aggregating</h2>
</div>
</div>
<div id="univariate-statistics" class="section level1">
<h1>Univariate statistics</h1>
<div id="means-and-cis" class="section level2">
<h2>means and CIs</h2>
</div>
<div id="comparing-cis-across-groups" class="section level2">
<h2>comparing CIs across groups</h2>
</div>
<div id="simple-means-tests-chisq-tests" class="section level2">
<h2>simple means tests, chisq tests</h2>
</div>
</div>
<div id="regression" class="section level1">
<h1>Regression</h1>
<div id="lm" class="section level2">
<h2>lm</h2>
<p>rescaling</p>
</div>
<div id="glm" class="section level2">
<h2>glm</h2>
<p>Intuition of the GLM</p>
<ul>
<li><span class="math inline">\(E[Y] = g^{-1}(X\beta)\)</span></li>
<li><span class="math inline">\(Y = E[Y] + \epsilon\)</span></li>
<li>or <span class="math inline">\(Y \sim \mathcal{D}(\theta)\)</span></li>
</ul>
</div>
<div id="lme4" class="section level2">
<h2>lme4</h2>
</div>
<div id="bayesian-models" class="section level2">
<h2>bayesian models</h2>
</div>
</div>
<div id="regression-output" class="section level1">
<h1>Regression output</h1>
<div id="regression-tables" class="section level2">
<h2>regression tables</h2>
<p><code>xtable</code>, <code>stargazer</code>, <code>texreg</code></p>
</div>
<div id="regression-coef-plots" class="section level2">
<h2>regression coef plots</h2>
<p>don’t use <code>coeftest</code></p>
<p><code>broom</code>,</p>
</div>
<div id="regression-predictions" class="section level2">
<h2>regression predictions</h2>
<p>maybe avoid <code>effects</code></p>
<p>use <code>sjplot</code>, <code>margins</code> for R</p>
</div>
<div id="marginal-effects" class="section level2">
<h2>marginal effects</h2>
</div>
<div id="time-series" class="section level2">
<h2>Time Series</h2>
<ul>
<li>Time series is just hard and you’re going to spend a lot of time beating your head against a wall. There is nothing I can do to fix this. But here are some tools that you should check out to help you.</li>
<li>Fixing data:</li>
<li>stata has <code>tsset</code> and you feed it a date, maybe a group</li>
<li>dplyr: <code>group_by(whatever)</code>, <code>arrange(date)</code></li>
<li>lags and leads just work on rows, so it won’t <em>know</em> to grab the previous date</li>
<li><code>zoo</code>? Creates an index variable</li>
<li><code>xts</code> requires the index to be a date</li>
<li>lubridate for date/time modification</li>
<li>RcppRoll for rolling averages</li>
<li>tidyquant has period-level apply functions (apply something weekly, for example)</li>
</ul>
</div>
</div>
<div id="user-defined-functions" class="section level1">
<h1>User-defined functions</h1>
<p>This section is a little complicated, so it’s okay if it doesn’t make perfect sense at first.</p>
<p>In R, it is easy to write your own functions. Here is an example of a function that calculates a mean.</p>
<pre class="r"><code>my_mean &lt;- function(z) {

  sum_z &lt;- sum(z)
  n &lt;- length(z)
  the_mean &lt;- sum_z / n
  
  return(the_mean)

}</code></pre>
<p>Here’s how this works.</p>
<p>First, we pick a name for the function. Here, we chose <code>my_mean</code>. If you don’t know if there are any existing functions with the same name, you can search for it in R’s help files (<code>?my_mean</code> and <code>??my_mean</code>).</p>
<p>Second, we decide which <em>arguments</em> this function should have. An argument is information that gets <em>passed</em> to the function. That’s what the <code>function(z)</code> is doing—the function takes one argument called <code>z</code>. We could have written <code>function(banana)</code> if we wanted, and then manipulated the <code>banana</code> object inside the function. The <code>z</code> (or <code>banana</code>) object name is just a stand-in for information that we are going to manipulate inside the function definition.</p>
<p>Third, the function needs a <em>definition</em> inside curly braces, meaning, what the function does. Technically, we <em>assign</em> a definition to the object called <code>my_mean</code>. (Yes, even functions are objects.) If we passed some variable to <code>my_mean()</code>, the function calculates the sum, finds the length, and then divides the sum by the length. Finally, the function <em>returns</em> the calculated value. In all, when we pass in some <code>z</code> data, we get out some value that is the result of <code>the_mean</code>.</p>
<p>For example, let’s make some data.</p>
<pre class="r"><code>(some_data &lt;- seq(0, 10, 2))</code></pre>
<pre><code>## [1]  0  2  4  6  8 10</code></pre>
<p>(Notice that the <code>seq(a, b, c)</code> function creates a sequence of values from <code>a</code> to <code>b</code> with a skip interval of <code>c</code>.) And then we will find the mean of this variable using our new mean function.</p>
<pre class="r"><code>my_mean(some_data)</code></pre>
<pre><code>## [1] 5</code></pre>
<p>There is one potentially-confusing point I need to make about custom functions. The variables that are manipulated inside the function definition are called <em>local variables</em>. This means they only exist in the world of that function. Although the function manipulates variables called <code>z</code>, <code>sum_z</code>, and so on, those variables only exist to that function and are not accessible to you in the rest of R’s memory. They exist only to make the function work. To demonstrate the point, print out all of the objects in R’s memory using the <code>ls()</code> function.</p>
<pre class="r"><code>ls()</code></pre>
<pre><code>## [1] &quot;my_mean&quot;   &quot;some_data&quot;</code></pre>
<p>You will notice that none of the objects created by <code>my_mean()</code> are there. This is by design, because you don’t want any function you create to get confused about whether the object you want to manipulate is local or global.</p>
</div>

  </div>
</section>
<section id="tag-pane" class="row meta">
  
  <div class="col-md-12">
    <h6 class="text-right meta">
      
      
      
      
    </h6>
  </div>
  
</section>








<section id="menu-pane" class="row menu text-center">
  
  
  <span><a class="menu-item" href="/811/811-data/">&lt; prev | </a></span>
  
  
  <span><a class="menu-item" href="/811">811</a></span>
  
  
  

  <section id="main-menu-pane" class="row text-center main-menu">
  <h4 class="text-center"><a class="menu-item" href="/">&nbsp;&nbsp;Home&nbsp;&nbsp;</a>
   
  <a class="menu-item" href="/about/">&nbsp;&nbsp;About&nbsp;&nbsp;</a>
  
  <a class="menu-item" href="/research/">&nbsp;&nbsp;Research&nbsp;&nbsp;</a>
  
  <a class="menu-item" href="/teaching/">&nbsp;&nbsp;Teaching&nbsp;&nbsp;</a>
  
  <a class="menu-item" href="/code/">&nbsp;&nbsp;Code&nbsp;&nbsp;</a>
  
  <a class="menu-item" href="/post/">&nbsp;&nbsp;Blog&nbsp;&nbsp;</a>
  
  <a class="menu-item" href="/contact/">&nbsp;&nbsp;Contact&nbsp;&nbsp;</a>
  </h4>
</section>
</section>




<footer class="row text-center footer">
  <hr />
  
  <h6 class="text-center copyright">© 2017 Michael DeCrescenzo. <a href="http://creativecommons.org/licenses/by/3.0/">Some rights reserved</a>.</h6>
  
  <h6 class="text-center powered">Powered by <a href="https://gohugo.io/">Hugo</a> &amp; <a href="https://github.com/shenoybr/hugo-goa">Goa</a>.</h6>
  
  
</footer>

</div>





<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>
  

<script type="text/javascript">
hljs.initHighlightingOnLoad();
</script>





<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
  });
  MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });

  MathJax.Hub.Config({
  
  TeX: { equationNumbers: { autoNumber: "AMS" } }
  });
</script>




<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="js/main.js"></script>
</body>
</html>


